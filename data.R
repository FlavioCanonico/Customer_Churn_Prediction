

#definisco quanti mesi sono passati dalla data stabilita al momento della prima analisi (42 mesi, che chiaramente aumenteranno)
date1='20160101'
date2= Sys.Date()
data_riferimento_PI=interval(ymd(date1),ymd(date2))
data_riferimento_PI= data_riferimento_PI %/% months(1)

#survival è semplicemente il nome della tabella
nome_survival = "survival_dwh"
# 
survival_all <- dplyr::tbl(sc, nome_survival)

survival = survival_all %>% filter(mesi_dalla_prima_attivazione <= data_riferimento_PI)

survival <- survival %>% mutate(serviziattivi = as.character(serviziattivi),
                                serviziattivaticliente = as.character(serviziattivaticliente),
                                tipocliente = as.character(tipocliente),
                                statoamministrativo = as.character(statoamministrativo),
                                ageingticketultimoreclamo = as.character(ageingticketultimoreclamo),
                                areanielsencliente = as.character(areanielsencliente),
                                primamodalita = as.character(primamodalita),
                                ultimamodalita = as.character(ultimamodalita),
                                tiposped = as.character(tiposped),
                                bu_co = as.character(bu_co),
                                primocanale = as.character(primocanale),
                                ultimocanale = as.character(ultimocanale),
                                canalemodale = as.character(canalemodale))

#definisco la variabile status, che sarà 1 se si verifica l'evento, cioé il churn
survival = survival %>% mutate(status = ifelse(clienteattivo == 0, 1, 0))


# creo la variabile canalidigitali, data dalla somma degli accessi ai canali digitali
# sommo tra loro quelle variabili (solo quelle che ha senso sommare) sui casi che hanno pochissime modalità
# diverse da 0, così da renderle utilizzabili
survival <- survival %>% mutate(canalidigitali = chat + selfcare + chatbot + telegram,
                                altra_variazione = variazione_spedizione + variazione_modulistica+ variazione_guasto + variazione_contorelax + variazione_attivazione,
                                altra_info = info_legale + info_autolettura +info_attivazione_non_richiesta + info_anagrafica + info_agevolazione,
                                altro_invio = invio_rimodulazione + invio_spedizione + invio_sconto_rimborso,
                                altro_reclamo = reclamo_sconto_rimborso + reclamo_contorelax +reclamo_attivazione_non_richiesta +reclamo_spedizione,
                                reclamo_lm_sum = reclamo_attivazione_lm + reclamo_credito_lm + reclamo_disattivazione_lm + reclamo_fattura_lm + reclamo_guasto_lm + reclamo_legale_lm)

#creo un indice con gli stati amministrativi perché altrimenti ad es. il numero di solleciti equivale al
#numero di fatture che è una dimensione che in qualche modo replica mesicliente
survival = survival %>% mutate(sollecitibase_index = n_sollecitibase / mesicliente,
                               ulteriorisolleciti_index = n_ulteriorisolleciti / mesicliente,
                               morosobloccato_index = n_morosobloccato / mesicliente)

# divido tutti i casi per i mesicliente, così ho i casi aperti in media dal cliente e correggo la distorsione dovuta al fatto che
# un cliente che ha vissuto molto ovviamente avrà più casi aperti.

survival = survival %>% mutate(campagna_autolettura = campagna_autolettura/mesicliente, campagna_contorelax = campagna_contorelax/mesicliente, campagna_crossselling = campagna_crossselling/mesicliente, campagna_fattura = campagna_fattura/mesicliente, campagna_recall = campagna_recall/mesicliente, campagna_rimodulazione = campagna_rimodulazione/mesicliente
                               , campagna_survey = campagna_survey/mesicliente, eliminare_eliminare = eliminare_eliminare/mesicliente, info_attivazione = info_attivazione/mesicliente, info_canali_digitali = info_canali_digitali/mesicliente, info_credito = info_credito/mesicliente, info_fattura = info_fattura/mesicliente, info_modulistica = info_modulistica/mesicliente, info_recapito_consulente = info_recapito_consulente/mesicliente, info_spedizione = info_spedizione/mesicliente, invio_contratto = invio_contratto/mesicliente, invio_fattura = invio_fattura/mesicliente, invio_sconto_rimborso = invio_sconto_rimborso/mesicliente, reclamo_attivazione = reclamo_attivazione/mesicliente, reclamo_contorelax = reclamo_contorelax/mesicliente, reclamo_eliminare = reclamo_eliminare/mesicliente, reclamo_legale = reclamo_legale/mesicliente, reclamo_sconto_rimborso = reclamo_sconto_rimborso/mesicliente, reclamo_voltura = reclamo_voltura/mesicliente, variazione_attivazione = variazione_attivazione/mesicliente, variazione_contratto = variazione_contratto/mesicliente, variazione_eliminare = variazione_eliminare/mesicliente, variazione_legale = variazione_legale/mesicliente, variazione_rimodulazione = variazione_rimodulazione/mesicliente, variazione_tecnico = variazione_tecnico/mesicliente
                               , campagna_agevolazione = campagna_agevolazione/mesicliente, campagna_canali_digitali = campagna_canali_digitali/mesicliente, campagna_contratto = campagna_contratto/mesicliente, campagna_disattivazione = campagna_disattivazione/mesicliente, campagna_guasto = campagna_guasto/mesicliente
                               ,campagna_recapito_consulente = campagna_recapito_consulente/mesicliente, campagna_sconto_rimborso = campagna_sconto_rimborso/mesicliente, campagna_tecnico = campagna_tecnico/mesicliente, info_agevolazione = info_agevolazione/mesicliente, info_attivazione_non_richiesta = info_attivazione_non_richiesta/mesicliente, info_contorelax = info_contorelax/mesicliente, info_disattivazione = info_disattivazione/mesicliente, info_guasto = info_guasto/mesicliente, info_pagamento = info_pagamento/mesicliente, info_rimodulazione = info_rimodulazione/mesicliente, info_tecnico = info_tecnico/mesicliente, invio_credito = invio_credito/mesicliente, invio_modulistica = invio_modulistica/mesicliente, invio_spedizione = invio_spedizione/mesicliente, reclamo_attivazione_non_richiesta = reclamo_attivazione_non_richiesta/mesicliente, reclamo_credito = reclamo_credito/mesicliente, reclamo_fattura = reclamo_fattura/mesicliente, reclamo_modulistica = reclamo_modulistica/mesicliente, reclamo_spedizione = reclamo_spedizione/mesicliente, variazione_agevolazione = variazione_agevolazione/mesicliente, variazione_autolettura = variazione_autolettura/mesicliente, variazione_credito = variazione_credito/mesicliente
                               , variazione_fattura = variazione_fattura/mesicliente, variazione_modulistica = variazione_modulistica/mesicliente ,  variazione_sconto_rimborso = variazione_sconto_rimborso/mesicliente, variazione_voltura = variazione_voltura/mesicliente
                               , campagna_attivazione = campagna_attivazione/mesicliente, campagna_churn = campagna_churn/mesicliente,
                               campagna_credito = campagna_credito/mesicliente, campagna_eliminare = campagna_eliminare/mesicliente, campagna_promo_offerte = campagna_promo_offerte/mesicliente,
                               campagna_retention = campagna_retention/ mesicliente, campagna_spedizione = campagna_spedizione/mesicliente, campagna_voltura = campagna_voltura/mesicliente, info_anagrafica = info_anagrafica/mesicliente, info_autolettura = info_autolettura/mesicliente, info_contratto = info_contratto/mesicliente, info_eliminare = info_eliminare/mesicliente, info_legale = info_legale/mesicliente, info_promo_offerte = info_promo_offerte/mesicliente, info_sconto_rimborso = info_sconto_rimborso/mesicliente, info_voltura = info_voltura/mesicliente, invio_eliminare = invio_eliminare/mesicliente, invio_rimodulazione = invio_rimodulazione/mesicliente, reclamo_agevolazione = reclamo_agevolazione/mesicliente, reclamo_canali_digitali = reclamo_canali_digitali/mesicliente, reclamo_disattivazione = reclamo_disattivazione/mesicliente, reclamo_guasto = reclamo_guasto/mesicliente, reclamo_promo_offerte = reclamo_promo_offerte/mesicliente, reclamo_tecnico = reclamo_tecnico/mesicliente, variazione_anagrafica = variazione_anagrafica/mesicliente, variazione_contorelax = variazione_contorelax/mesicliente, variazione_disattivazione = variazione_disattivazione/mesicliente, variazione_guasto = variazione_guasto/mesicliente, variazione_pagamento = variazione_pagamento/mesicliente, variazione_spedizione = variazione_spedizione/mesicliente,
                               altro_reclamo = altro_reclamo/mesicliente,altro_invio = altro_invio/mesicliente)

###split in pib/pic/sciolto
pib <- survival %>% filter(pib >= 1 || pib_gia_cliente >= 1)
pic <- survival %>% filter(pic >= 1)

# problema: i clienti attivi che hanno avuto un pi ma che adesso hanno solo prodotto sciolto attivo li inserisco nei pi
# (173 clienti) per correggere quest'errore inserisco questi clienti in survival_sciolto e li elimino dagli altri datasets

survival_sciolto <- dplyr::union(survival_sciolto, pic %>% filter(sciolto_att >=1 & pic_att == 0))
survival_sciolto <- dplyr::union(survival_sciolto, pib %>% filter(sciolto_att >=1 & pib_att == 0 & pib_gia_cliente_att == 0))

pib <- pib %>% filter(!((sciolto_att >=1 & pib_att == 0 & pib_gia_cliente_att == 0)))
pic <- pic %>% filter(!(sciolto_att >=1 & pic_att == 0))

###altro problema: ho duplicati su pib e pic perché alcuni clienti per errore sono individuati sia come
#pic che come pib allo stesso tempo. prendendo la variabile bu_co dal dwh da cui legge il crm, correggo l'errore
#riassegnando i duplicati a pib o pic.
index <- pic %>% select(cliente)
dups <- pib %>% inner_join(index, by = "cliente")
pib <- pib %>% anti_join(dups, by = "cliente")
pic <- pic %>% anti_join(dups, by = "cliente")

dups_pib <- dups %>% filter(bu_co == "BUSINESS")
dups_pic <- dups %>% filter(bu_co == "CONSUMER")

pib <- dplyr::union(pib, dups_pib)
pic <- dplyr::union(pic, dups_pic)

#Dqa qui in avanti continuo solo sui clienti Business (PIB)

#questa variabile mi serve nella foresta e mi dice se un clt pi ha o ha avuto anche un contratto prodotto sciolto
pib = pib %>% mutate(flag_sciolto = ifelse(sciolto > 0,1,0))

#se decido di usare la var bu_co per lo sciolto mi conviene eliminare idcliente pubblica amministrazione, perché sono solo 8
pib <- pib %>% filter(bu_co != "Pubblica Amministrazione")

# #prima di standardizzare mi creo delle copie dei dataset non standardizzati
survival_pib_unscaled <- pib

# names_da_std <- c("n_utenze","etareferente"	,"retediretta"	,"reteindiretta"	,"campagna_autolettura"	,"campagna_contorelax","campagna_crossselling"	,"campagna_fattura"	,"campagna_recall"	,"campagna_rimodulazione"	,"campagna_survey"	,"eliminare_eliminare"	,"info_attivazione"	,"info_canali_digitali"	,"info_credito","info_fattura"	,"info_modulistica"	,"info_recapito_consulente"	,"info_spedizione"	,"invio_contratto","invio_fattura"	,"invio_sconto_rimborso"	,"reclamo_attivazione"	,"reclamo_contorelax"	,"reclamo_eliminare"	,"reclamo_legale"	,"reclamo_sconto_rimborso"	,"reclamo_voltura","variazione_attivazione"	,"variazione_contratto"	,"variazione_eliminare"	,"variazione_legale","variazione_rimodulazione"	,"variazione_tecnico"	,"campagna_autolettura_lm"	,"campagna_contorelax_lm"	,"campagna_crossselling_lm"	,"campagna_fattura_lm"	,"campagna_recall_lm"	,"campagna_rimodulazione_lm","campagna_survey_lm"	,"eliminare_eliminare_lm"	,"info_attivazione_lm"	,"info_canali_digitali_lm","info_credito_lm"	,"info_fattura_lm"	,"info_modulistica_lm"	,"info_recapito_consulente_lm","info_spedizione_lm"	,"invio_contratto_lm"	,"invio_fattura_lm"	,"invio_sconto_rimborso_lm","reclamo_attivazione_lm"	,"reclamo_contorelax_lm"	,"reclamo_eliminare_lm"	,"reclamo_legale_lm","reclamo_sconto_rimborso_lm"	,"reclamo_voltura_lm"	,"variazione_attivazione_lm"	,"variazione_contratto_lm","variazione_eliminare_lm"	,"variazione_legale_lm"	,"variazione_rimodulazione_lm"	,"variazione_tecnico_lm","numerocambipag"	,"n_sollecitibase"	,"canalidigitali"	,"altra_info"	,"altra_variazione"	,"ulteriorisolleciti_index"	,"n_utenze_attive"	,"web"	,"teleselling"	,"campagna_agevolazione","campagna_canali_digitali"	,"campagna_contratto"	,"campagna_disattivazione"	,"campagna_guasto","campagna_recapito_consulente"	,"campagna_sconto_rimborso"	,"campagna_tecnico"	,"info_agevolazione","info_attivazione_non_richiesta"	,"info_contorelax"	,"info_disattivazione"	,"info_guasto","info_pagamento"	,"info_rimodulazione"	,"info_tecnico"	,"invio_credito"	,"invio_modulistica","invio_spedizione"	,"reclamo_attivazione_non_richiesta"	,"reclamo_credito"	,"reclamo_fattura","reclamo_modulistica"	,"reclamo_spedizione"	,"variazione_agevolazione"	,"variazione_autolettura","variazione_credito"	,"variazione_fattura"	,"variazione_modulistica"	,"variazione_sconto_rimborso","variazione_voltura"	,"campagna_canali_digitali_lm"	,"campagna_contratto_lm","campagna_disattivazione_lm","campagna_guasto_lm"	,"campagna_recapito_consulente_lm"	,"campagna_sconto_rimborso_lm","campagna_tecnico_lm"	,"info_agevolazione_lm"	,"info_attivazione_non_richiesta_lm","info_contorelax_lm"	,"info_disattivazione_lm"	,"info_guasto_lm"	,"info_pagamento_lm","info_rimodulazione_lm"	,"info_tecnico_lm"	,"invio_credito_lm"	,"invio_modulistica_lm","invio_spedizione_lm"	,"reclamo_attivazione_non_richiesta_lm"	,"reclamo_credito_lm"	,"reclamo_fattura_lm","reclamo_modulistica_lm"	,"reclamo_spedizione_lm"	,"variazione_agevolazione_lm"	,"variazione_autolettura_lm"	,"variazione_credito_lm"	,"variazione_fattura_lm","variazione_modulistica_lm"	,"variazione_sconto_rimborso_lm"	,"ggultimocambio"	,"n_ulteriorisolleciti","altro_invio"	,"reclamo_lm_sum"	,"morosobloccato_index"	,"campagnanazionale","comparatori"	,"campagna_attivazione"	,"campagna_churn"	,"campagna_credito"	,"campagna_eliminare","campagna_promo_offerte"	,"campagna_retention"	,"campagna_spedizione"	,"campagna_voltura"	,"info_anagrafica"	,"info_autolettura"	,"info_contratto"	,"info_eliminare"	,"info_legale","info_promo_offerte"	,"info_sconto_rimborso"	,"info_voltura"	,"invio_eliminare"	,"invio_rimodulazione","reclamo_agevolazione"	,"reclamo_canali_digitali"	,"reclamo_disattivazione"	,"reclamo_guasto","reclamo_promo_offerte"	,"reclamo_tecnico"	,"variazione_anagrafica"	,"variazione_contorelax","variazione_disattivazione"	,"variazione_guasto"	,"variazione_pagamento"	,"variazione_spedizione"	,"campagna_attivazione_lm"
#                   ,"campagna_churn_lm"	,"campagna_credito_lm"	,"campagna_eliminare_lm"	,"campagna_promo_offerte_lm"	,"campagna_retention_lm"
#                   ,"campagna_spedizione_lm"	,"campagna_voltura_lm"	,"info_anagrafica_lm"	,"info_autolettura_lm"	,"info_contratto_lm"	,"info_eliminare_lm"
#                   ,"info_legale_lm"	,"info_promo_offerte_lm"	,"info_sconto_rimborso_lm"	,"info_voltura_lm"	,"invio_eliminare_lm"	,"invio_rimodulazione_lm"
#                   ,"reclamo_agevolazione_lm"	,"reclamo_canali_digitali_lm"	,"reclamo_disattivazione_lm"	,"reclamo_guasto_lm"	,"reclamo_promo_offerte_lm"
#                   ,"reclamo_tecnico_lm"	,"variazione_anagrafica_lm"	,"variazione_contorelax_lm"	,"variazione_disattivazione_lm"	,"variazione_guasto_lm"
#                   ,"variazione_pagamento_lm"	,"variazione_spedizione_lm"	,"n_morosobloccato"	,"altro_reclamo"	,"sollecitibase_index"
#                   ,"fattmedia" ,"fattmediae","fattmediag","fattmediav","fattmediaa","fattmediam","fattmediaaltro")
# 
# for(i in 1:length(names_da_std)){
#   print(paste0(names_da_std[i],"=(",names_da_std[i],"-mean(",names_da_std[i],",na.rm=T))/sd(",names_da_std[i],",na.rm=T),"))
#   }
#la function scale() da problemi quindi ne scrivo una custom
# standardizza <- function(x){
#   (x - mean(x, na.rm = TRUE))/sd(x, na.rm = TRUE)
# }
#
#mutate(n_utenze = standardizza(n_utenze))
# pib %>% ft_vector_assembler(input_cols="n_utenze","etareferente", output_cols="n_utenze2","etareferente2") %>% 
#   ft_standard_scaler(input_col="n_utenze2","etareferente2", output_cols="n_utenze3","etareferente3", with_mean = TRUE) %>% select(n_utenze)
# 
pib = pib %>% mutate(n_utenze=(n_utenze-mean(n_utenze,na.rm=T))/sd(n_utenze,na.rm=T),	reclamo_agevolazione_lm=(reclamo_agevolazione_lm-mean(reclamo_agevolazione_lm,na.rm=T))/sd(reclamo_agevolazione_lm,na.rm=T),	variazione_guasto=(variazione_guasto-mean(variazione_guasto,na.rm=T))/sd(variazione_guasto,na.rm=T),	campagna_spedizione=(campagna_spedizione-mean(campagna_spedizione,na.rm=T))/sd(campagna_spedizione,na.rm=T),	reclamo_modulistica_lm=(reclamo_modulistica_lm-mean(reclamo_modulistica_lm,na.rm=T))/sd(reclamo_modulistica_lm,na.rm=T),	variazione_voltura=(variazione_voltura-mean(variazione_voltura,na.rm=T))/sd(variazione_voltura,na.rm=T),	info_agevolazione=(info_agevolazione-mean(info_agevolazione,na.rm=T))/sd(info_agevolazione,na.rm=T),	variazione_contratto_lm=(variazione_contratto_lm-mean(variazione_contratto_lm,na.rm=T))/sd(variazione_contratto_lm,na.rm=T),	campagna_crossselling_lm=(campagna_crossselling_lm-mean(campagna_crossselling_lm,na.rm=T))/sd(campagna_crossselling_lm,na.rm=T),	reclamo_contorelax=(reclamo_contorelax-mean(reclamo_contorelax,na.rm=T))/sd(reclamo_contorelax,na.rm=T),
                                       etareferente=(etareferente-mean(etareferente,na.rm=T))/sd(etareferente,na.rm=T),	reclamo_canali_digitali_lm=(reclamo_canali_digitali_lm-mean(reclamo_canali_digitali_lm,na.rm=T))/sd(reclamo_canali_digitali_lm,na.rm=T),	variazione_pagamento=(variazione_pagamento-mean(variazione_pagamento,na.rm=T))/sd(variazione_pagamento,na.rm=T),	campagna_voltura=(campagna_voltura-mean(campagna_voltura,na.rm=T))/sd(campagna_voltura,na.rm=T),	reclamo_spedizione_lm=(reclamo_spedizione_lm-mean(reclamo_spedizione_lm,na.rm=T))/sd(reclamo_spedizione_lm,na.rm=T),	campagna_canali_digitali_lm=(campagna_canali_digitali_lm-mean(campagna_canali_digitali_lm,na.rm=T))/sd(campagna_canali_digitali_lm,na.rm=T),	info_attivazione_non_richiesta=(info_attivazione_non_richiesta-mean(info_attivazione_non_richiesta,na.rm=T))/sd(info_attivazione_non_richiesta,na.rm=T),	variazione_eliminare_lm=(variazione_eliminare_lm-mean(variazione_eliminare_lm,na.rm=T))/sd(variazione_eliminare_lm,na.rm=T),	campagna_fattura_lm=(campagna_fattura_lm-mean(campagna_fattura_lm,na.rm=T))/sd(campagna_fattura_lm,na.rm=T),	reclamo_eliminare=(reclamo_eliminare-mean(reclamo_eliminare,na.rm=T))/sd(reclamo_eliminare,na.rm=T),
                                       retediretta=(retediretta-mean(retediretta,na.rm=T))/sd(retediretta,na.rm=T),	reclamo_disattivazione_lm=(reclamo_disattivazione_lm-mean(reclamo_disattivazione_lm,na.rm=T))/sd(reclamo_disattivazione_lm,na.rm=T),	variazione_spedizione=(variazione_spedizione-mean(variazione_spedizione,na.rm=T))/sd(variazione_spedizione,na.rm=T),	info_anagrafica=(info_anagrafica-mean(info_anagrafica,na.rm=T))/sd(info_anagrafica,na.rm=T),	variazione_agevolazione_lm=(variazione_agevolazione_lm-mean(variazione_agevolazione_lm,na.rm=T))/sd(variazione_agevolazione_lm,na.rm=T),	campagna_contratto_lm=(campagna_contratto_lm-mean(campagna_contratto_lm,na.rm=T))/sd(campagna_contratto_lm,na.rm=T),	info_contorelax=(info_contorelax-mean(info_contorelax,na.rm=T))/sd(info_contorelax,na.rm=T),	variazione_legale_lm=(variazione_legale_lm-mean(variazione_legale_lm,na.rm=T))/sd(variazione_legale_lm,na.rm=T),	campagna_recall_lm=(campagna_recall_lm-mean(campagna_recall_lm,na.rm=T))/sd(campagna_recall_lm,na.rm=T),	reclamo_legale=(reclamo_legale-mean(reclamo_legale,na.rm=T))/sd(reclamo_legale,na.rm=T),
                                       reteindiretta=(reteindiretta-mean(reteindiretta,na.rm=T))/sd(reteindiretta,na.rm=T),	reclamo_guasto_lm=(reclamo_guasto_lm-mean(reclamo_guasto_lm,na.rm=T))/sd(reclamo_guasto_lm,na.rm=T),	campagna_attivazione_lm=(campagna_attivazione_lm-mean(campagna_attivazione_lm,na.rm=T))/sd(campagna_attivazione_lm,na.rm=T),	info_autolettura=(info_autolettura-mean(info_autolettura,na.rm=T))/sd(info_autolettura,na.rm=T),	variazione_autolettura_lm=(variazione_autolettura_lm-mean(variazione_autolettura_lm,na.rm=T))/sd(variazione_autolettura_lm,na.rm=T),	campagna_disattivazione_lm=(campagna_disattivazione_lm-mean(campagna_disattivazione_lm,na.rm=T))/sd(campagna_disattivazione_lm,na.rm=T),	info_disattivazione=(info_disattivazione-mean(info_disattivazione,na.rm=T))/sd(info_disattivazione,na.rm=T),	variazione_rimodulazione_lm=(variazione_rimodulazione_lm-mean(variazione_rimodulazione_lm,na.rm=T))/sd(variazione_rimodulazione_lm,na.rm=T),	campagna_rimodulazione_lm=(campagna_rimodulazione_lm-mean(campagna_rimodulazione_lm,na.rm=T))/sd(campagna_rimodulazione_lm,na.rm=T),	reclamo_sconto_rimborso=(reclamo_sconto_rimborso-mean(reclamo_sconto_rimborso,na.rm=T))/sd(reclamo_sconto_rimborso,na.rm=T),
                                       campagna_autolettura=(campagna_autolettura-mean(campagna_autolettura,na.rm=T))/sd(campagna_autolettura,na.rm=T),	reclamo_promo_offerte_lm=(reclamo_promo_offerte_lm-mean(reclamo_promo_offerte_lm,na.rm=T))/sd(reclamo_promo_offerte_lm,na.rm=T),	campagna_churn_lm=(campagna_churn_lm-mean(campagna_churn_lm,na.rm=T))/sd(campagna_churn_lm,na.rm=T),	info_contratto=(info_contratto-mean(info_contratto,na.rm=T))/sd(info_contratto,na.rm=T),	variazione_credito_lm=(variazione_credito_lm-mean(variazione_credito_lm,na.rm=T))/sd(variazione_credito_lm,na.rm=T),	campagna_guasto_lm=(campagna_guasto_lm-mean(campagna_guasto_lm,na.rm=T))/sd(campagna_guasto_lm,na.rm=T),	info_guasto=(info_guasto-mean(info_guasto,na.rm=T))/sd(info_guasto,na.rm=T),	variazione_tecnico_lm=(variazione_tecnico_lm-mean(variazione_tecnico_lm,na.rm=T))/sd(variazione_tecnico_lm,na.rm=T),	campagna_survey_lm=(campagna_survey_lm-mean(campagna_survey_lm,na.rm=T))/sd(campagna_survey_lm,na.rm=T),	reclamo_voltura=(reclamo_voltura-mean(reclamo_voltura,na.rm=T))/sd(reclamo_voltura,na.rm=T),
                                       campagna_contorelax=(campagna_contorelax-mean(campagna_contorelax,na.rm=T))/sd(campagna_contorelax,na.rm=T),	reclamo_tecnico_lm=(reclamo_tecnico_lm-mean(reclamo_tecnico_lm,na.rm=T))/sd(reclamo_tecnico_lm,na.rm=T),	campagna_credito_lm=(campagna_credito_lm-mean(campagna_credito_lm,na.rm=T))/sd(campagna_credito_lm,na.rm=T),	info_eliminare=(info_eliminare-mean(info_eliminare,na.rm=T))/sd(info_eliminare,na.rm=T),	variazione_fattura_lm=(variazione_fattura_lm-mean(variazione_fattura_lm,na.rm=T))/sd(variazione_fattura_lm,na.rm=T),	campagna_recapito_consulente_lm=(campagna_recapito_consulente_lm-mean(campagna_recapito_consulente_lm,na.rm=T))/sd(campagna_recapito_consulente_lm,na.rm=T),	info_pagamento=(info_pagamento-mean(info_pagamento,na.rm=T))/sd(info_pagamento,na.rm=T),	numerocambipag=(numerocambipag-mean(numerocambipag,na.rm=T))/sd(numerocambipag,na.rm=T),	eliminare_eliminare_lm=(eliminare_eliminare_lm-mean(eliminare_eliminare_lm,na.rm=T))/sd(eliminare_eliminare_lm,na.rm=T),	variazione_attivazione=(variazione_attivazione-mean(variazione_attivazione,na.rm=T))/sd(variazione_attivazione,na.rm=T),
                                       campagna_crossselling=(campagna_crossselling-mean(campagna_crossselling,na.rm=T))/sd(campagna_crossselling,na.rm=T),	variazione_anagrafica_lm=(variazione_anagrafica_lm-mean(variazione_anagrafica_lm,na.rm=T))/sd(variazione_anagrafica_lm,na.rm=T),	campagna_eliminare_lm=(campagna_eliminare_lm-mean(campagna_eliminare_lm,na.rm=T))/sd(campagna_eliminare_lm,na.rm=T),	info_legale=(info_legale-mean(info_legale,na.rm=T))/sd(info_legale,na.rm=T),	variazione_modulistica_lm=(variazione_modulistica_lm-mean(variazione_modulistica_lm,na.rm=T))/sd(variazione_modulistica_lm,na.rm=T),	campagna_sconto_rimborso_lm=(campagna_sconto_rimborso_lm-mean(campagna_sconto_rimborso_lm,na.rm=T))/sd(campagna_sconto_rimborso_lm,na.rm=T),	info_rimodulazione=(info_rimodulazione-mean(info_rimodulazione,na.rm=T))/sd(info_rimodulazione,na.rm=T),	n_sollecitibase=(n_sollecitibase-mean(n_sollecitibase,na.rm=T))/sd(n_sollecitibase,na.rm=T),	info_attivazione_lm=(info_attivazione_lm-mean(info_attivazione_lm,na.rm=T))/sd(info_attivazione_lm,na.rm=T),	variazione_contratto=(variazione_contratto-mean(variazione_contratto,na.rm=T))/sd(variazione_contratto,na.rm=T),
                                       campagna_fattura=(campagna_fattura-mean(campagna_fattura,na.rm=T))/sd(campagna_fattura,na.rm=T),	variazione_contorelax_lm=(variazione_contorelax_lm-mean(variazione_contorelax_lm,na.rm=T))/sd(variazione_contorelax_lm,na.rm=T),	campagna_promo_offerte_lm=(campagna_promo_offerte_lm-mean(campagna_promo_offerte_lm,na.rm=T))/sd(campagna_promo_offerte_lm,na.rm=T),	info_promo_offerte=(info_promo_offerte-mean(info_promo_offerte,na.rm=T))/sd(info_promo_offerte,na.rm=T),	variazione_sconto_rimborso_lm=(variazione_sconto_rimborso_lm-mean(variazione_sconto_rimborso_lm,na.rm=T))/sd(variazione_sconto_rimborso_lm,na.rm=T),	campagna_tecnico_lm=(campagna_tecnico_lm-mean(campagna_tecnico_lm,na.rm=T))/sd(campagna_tecnico_lm,na.rm=T),	info_tecnico=(info_tecnico-mean(info_tecnico,na.rm=T))/sd(info_tecnico,na.rm=T),	canalidigitali=(canalidigitali-mean(canalidigitali,na.rm=T))/sd(canalidigitali,na.rm=T),	info_canali_digitali_lm=(info_canali_digitali_lm-mean(info_canali_digitali_lm,na.rm=T))/sd(info_canali_digitali_lm,na.rm=T),	variazione_eliminare=(variazione_eliminare-mean(variazione_eliminare,na.rm=T))/sd(variazione_eliminare,na.rm=T),
                                       campagna_recall=(campagna_recall-mean(campagna_recall,na.rm=T))/sd(campagna_recall,na.rm=T),	variazione_disattivazione_lm=(variazione_disattivazione_lm-mean(variazione_disattivazione_lm,na.rm=T))/sd(variazione_disattivazione_lm,na.rm=T),	campagna_retention_lm=(campagna_retention_lm-mean(campagna_retention_lm,na.rm=T))/sd(campagna_retention_lm,na.rm=T),	info_sconto_rimborso=(info_sconto_rimborso-mean(info_sconto_rimborso,na.rm=T))/sd(info_sconto_rimborso,na.rm=T),	ggultimocambio=(ggultimocambio-mean(ggultimocambio,na.rm=T))/sd(ggultimocambio,na.rm=T),	info_agevolazione_lm=(info_agevolazione_lm-mean(info_agevolazione_lm,na.rm=T))/sd(info_agevolazione_lm,na.rm=T),	invio_credito=(invio_credito-mean(invio_credito,na.rm=T))/sd(invio_credito,na.rm=T),	altra_info=(altra_info-mean(altra_info,na.rm=T))/sd(altra_info,na.rm=T),	info_credito_lm=(info_credito_lm-mean(info_credito_lm,na.rm=T))/sd(info_credito_lm,na.rm=T),	variazione_legale=(variazione_legale-mean(variazione_legale,na.rm=T))/sd(variazione_legale,na.rm=T),
                                       campagna_rimodulazione=(campagna_rimodulazione-mean(campagna_rimodulazione,na.rm=T))/sd(campagna_rimodulazione,na.rm=T),	variazione_guasto_lm=(variazione_guasto_lm-mean(variazione_guasto_lm,na.rm=T))/sd(variazione_guasto_lm,na.rm=T),	campagna_spedizione_lm=(campagna_spedizione_lm-mean(campagna_spedizione_lm,na.rm=T))/sd(campagna_spedizione_lm,na.rm=T),	info_voltura=(info_voltura-mean(info_voltura,na.rm=T))/sd(info_voltura,na.rm=T),	n_ulteriorisolleciti=(n_ulteriorisolleciti-mean(n_ulteriorisolleciti,na.rm=T))/sd(n_ulteriorisolleciti,na.rm=T),	info_attivazione_non_richiesta_lm=(info_attivazione_non_richiesta_lm-mean(info_attivazione_non_richiesta_lm,na.rm=T))/sd(info_attivazione_non_richiesta_lm,na.rm=T),	invio_modulistica=(invio_modulistica-mean(invio_modulistica,na.rm=T))/sd(invio_modulistica,na.rm=T),	altra_variazione=(altra_variazione-mean(altra_variazione,na.rm=T))/sd(altra_variazione,na.rm=T),	info_fattura_lm=(info_fattura_lm-mean(info_fattura_lm,na.rm=T))/sd(info_fattura_lm,na.rm=T),	variazione_rimodulazione=(variazione_rimodulazione-mean(variazione_rimodulazione,na.rm=T))/sd(variazione_rimodulazione,na.rm=T),
                                       campagna_survey=(campagna_survey-mean(campagna_survey,na.rm=T))/sd(campagna_survey,na.rm=T),	variazione_pagamento_lm=(variazione_pagamento_lm-mean(variazione_pagamento_lm,na.rm=T))/sd(variazione_pagamento_lm,na.rm=T),	campagna_voltura_lm=(campagna_voltura_lm-mean(campagna_voltura_lm,na.rm=T))/sd(campagna_voltura_lm,na.rm=T),	invio_eliminare=(invio_eliminare-mean(invio_eliminare,na.rm=T))/sd(invio_eliminare,na.rm=T),	altro_invio=(altro_invio-mean(altro_invio,na.rm=T))/sd(altro_invio,na.rm=T),	info_contorelax_lm=(info_contorelax_lm-mean(info_contorelax_lm,na.rm=T))/sd(info_contorelax_lm,na.rm=T),	invio_spedizione=(invio_spedizione-mean(invio_spedizione,na.rm=T))/sd(invio_spedizione,na.rm=T),	ulteriorisolleciti_index=(ulteriorisolleciti_index-mean(ulteriorisolleciti_index,na.rm=T))/sd(ulteriorisolleciti_index,na.rm=T),	info_modulistica_lm=(info_modulistica_lm-mean(info_modulistica_lm,na.rm=T))/sd(info_modulistica_lm,na.rm=T),	variazione_tecnico=(variazione_tecnico-mean(variazione_tecnico,na.rm=T))/sd(variazione_tecnico,na.rm=T),
                                       eliminare_eliminare=(eliminare_eliminare-mean(eliminare_eliminare,na.rm=T))/sd(eliminare_eliminare,na.rm=T),	variazione_spedizione_lm=(variazione_spedizione_lm-mean(variazione_spedizione_lm,na.rm=T))/sd(variazione_spedizione_lm,na.rm=T),	info_anagrafica_lm=(info_anagrafica_lm-mean(info_anagrafica_lm,na.rm=T))/sd(info_anagrafica_lm,na.rm=T),	invio_rimodulazione=(invio_rimodulazione-mean(invio_rimodulazione,na.rm=T))/sd(invio_rimodulazione,na.rm=T),	reclamo_lm_sum=(reclamo_lm_sum-mean(reclamo_lm_sum,na.rm=T))/sd(reclamo_lm_sum,na.rm=T),	info_disattivazione_lm=(info_disattivazione_lm-mean(info_disattivazione_lm,na.rm=T))/sd(info_disattivazione_lm,na.rm=T),	reclamo_attivazione_non_richiesta=(reclamo_attivazione_non_richiesta-mean(reclamo_attivazione_non_richiesta,na.rm=T))/sd(reclamo_attivazione_non_richiesta,na.rm=T),	n_utenze_attive=(n_utenze_attive-mean(n_utenze_attive,na.rm=T))/sd(n_utenze_attive,na.rm=T),	info_recapito_consulente_lm=(info_recapito_consulente_lm-mean(info_recapito_consulente_lm,na.rm=T))/sd(info_recapito_consulente_lm,na.rm=T),	campagna_autolettura_lm=(campagna_autolettura_lm-mean(campagna_autolettura_lm,na.rm=T))/sd(campagna_autolettura_lm,na.rm=T),
                                       info_attivazione=(info_attivazione-mean(info_attivazione,na.rm=T))/sd(info_attivazione,na.rm=T),	n_morosobloccato=(n_morosobloccato-mean(n_morosobloccato,na.rm=T))/sd(n_morosobloccato,na.rm=T),	info_autolettura_lm=(info_autolettura_lm-mean(info_autolettura_lm,na.rm=T))/sd(info_autolettura_lm,na.rm=T),	reclamo_agevolazione=(reclamo_agevolazione-mean(reclamo_agevolazione,na.rm=T))/sd(reclamo_agevolazione,na.rm=T),	morosobloccato_index=(morosobloccato_index-mean(morosobloccato_index,na.rm=T))/sd(morosobloccato_index,na.rm=T),	info_guasto_lm=(info_guasto_lm-mean(info_guasto_lm,na.rm=T))/sd(info_guasto_lm,na.rm=T),	reclamo_credito=(reclamo_credito-mean(reclamo_credito,na.rm=T))/sd(reclamo_credito,na.rm=T),	web=(web-mean(web,na.rm=T))/sd(web,na.rm=T),	info_spedizione_lm=(info_spedizione_lm-mean(info_spedizione_lm,na.rm=T))/sd(info_spedizione_lm,na.rm=T),	campagna_contorelax_lm=(campagna_contorelax_lm-mean(campagna_contorelax_lm,na.rm=T))/sd(campagna_contorelax_lm,na.rm=T),
                                       info_canali_digitali=(info_canali_digitali-mean(info_canali_digitali,na.rm=T))/sd(info_canali_digitali,na.rm=T),	altro_reclamo=(altro_reclamo-mean(altro_reclamo,na.rm=T))/sd(altro_reclamo,na.rm=T),	info_contratto_lm=(info_contratto_lm-mean(info_contratto_lm,na.rm=T))/sd(info_contratto_lm,na.rm=T),	reclamo_canali_digitali=(reclamo_canali_digitali-mean(reclamo_canali_digitali,na.rm=T))/sd(reclamo_canali_digitali,na.rm=T),	campagnanazionale=(campagnanazionale-mean(campagnanazionale,na.rm=T))/sd(campagnanazionale,na.rm=T),	info_pagamento_lm=(info_pagamento_lm-mean(info_pagamento_lm,na.rm=T))/sd(info_pagamento_lm,na.rm=T),	reclamo_fattura=(reclamo_fattura-mean(reclamo_fattura,na.rm=T))/sd(reclamo_fattura,na.rm=T),	teleselling=(teleselling-mean(teleselling,na.rm=T))/sd(teleselling,na.rm=T),	invio_contratto_lm=(invio_contratto_lm-mean(invio_contratto_lm,na.rm=T))/sd(invio_contratto_lm,na.rm=T),	
                                       info_credito=(info_credito-mean(info_credito,na.rm=T))/sd(info_credito,na.rm=T),	sollecitibase_index=(sollecitibase_index-mean(sollecitibase_index,na.rm=T))/sd(sollecitibase_index,na.rm=T),	info_eliminare_lm=(info_eliminare_lm-mean(info_eliminare_lm,na.rm=T))/sd(info_eliminare_lm,na.rm=T),	reclamo_disattivazione=(reclamo_disattivazione-mean(reclamo_disattivazione,na.rm=T))/sd(reclamo_disattivazione,na.rm=T),	comparatori=(comparatori-mean(comparatori,na.rm=T))/sd(comparatori,na.rm=T),	info_rimodulazione_lm=(info_rimodulazione_lm-mean(info_rimodulazione_lm,na.rm=T))/sd(info_rimodulazione_lm,na.rm=T),	reclamo_modulistica=(reclamo_modulistica-mean(reclamo_modulistica,na.rm=T))/sd(reclamo_modulistica,na.rm=T),	campagna_agevolazione=(campagna_agevolazione-mean(campagna_agevolazione,na.rm=T))/sd(campagna_agevolazione,na.rm=T),	invio_fattura_lm=(invio_fattura_lm-mean(invio_fattura_lm,na.rm=T))/sd(invio_fattura_lm,na.rm=T),	
                                       info_fattura=(info_fattura-mean(info_fattura,na.rm=T))/sd(info_fattura,na.rm=T),	fattmedia=(fattmedia-mean(fattmedia,na.rm=T))/sd(fattmedia,na.rm=T),	info_legale_lm=(info_legale_lm-mean(info_legale_lm,na.rm=T))/sd(info_legale_lm,na.rm=T),	reclamo_guasto=(reclamo_guasto-mean(reclamo_guasto,na.rm=T))/sd(reclamo_guasto,na.rm=T),	campagna_attivazione=(campagna_attivazione-mean(campagna_attivazione,na.rm=T))/sd(campagna_attivazione,na.rm=T),	info_tecnico_lm=(info_tecnico_lm-mean(info_tecnico_lm,na.rm=T))/sd(info_tecnico_lm,na.rm=T),	reclamo_spedizione=(reclamo_spedizione-mean(reclamo_spedizione,na.rm=T))/sd(reclamo_spedizione,na.rm=T),	campagna_canali_digitali=(campagna_canali_digitali-mean(campagna_canali_digitali,na.rm=T))/sd(campagna_canali_digitali,na.rm=T),	invio_sconto_rimborso_lm=(invio_sconto_rimborso_lm-mean(invio_sconto_rimborso_lm,na.rm=T))/sd(invio_sconto_rimborso_lm,na.rm=T),	
                                       info_modulistica=(info_modulistica-mean(info_modulistica,na.rm=T))/sd(info_modulistica,na.rm=T),	fattmediae=(fattmediae-mean(fattmediae,na.rm=T))/sd(fattmediae,na.rm=T),	info_promo_offerte_lm=(info_promo_offerte_lm-mean(info_promo_offerte_lm,na.rm=T))/sd(info_promo_offerte_lm,na.rm=T),	reclamo_promo_offerte=(reclamo_promo_offerte-mean(reclamo_promo_offerte,na.rm=T))/sd(reclamo_promo_offerte,na.rm=T),	campagna_churn=(campagna_churn-mean(campagna_churn,na.rm=T))/sd(campagna_churn,na.rm=T),	invio_credito_lm=(invio_credito_lm-mean(invio_credito_lm,na.rm=T))/sd(invio_credito_lm,na.rm=T),	variazione_agevolazione=(variazione_agevolazione-mean(variazione_agevolazione,na.rm=T))/sd(variazione_agevolazione,na.rm=T),	campagna_contratto=(campagna_contratto-mean(campagna_contratto,na.rm=T))/sd(campagna_contratto,na.rm=T),	reclamo_attivazione_lm=(reclamo_attivazione_lm-mean(reclamo_attivazione_lm,na.rm=T))/sd(reclamo_attivazione_lm,na.rm=T),	
                                       info_recapito_consulente=(info_recapito_consulente-mean(info_recapito_consulente,na.rm=T))/sd(info_recapito_consulente,na.rm=T),	fattmediag=(fattmediag-mean(fattmediag,na.rm=T))/sd(fattmediag,na.rm=T),	info_sconto_rimborso_lm=(info_sconto_rimborso_lm-mean(info_sconto_rimborso_lm,na.rm=T))/sd(info_sconto_rimborso_lm,na.rm=T),	reclamo_tecnico=(reclamo_tecnico-mean(reclamo_tecnico,na.rm=T))/sd(reclamo_tecnico,na.rm=T),	campagna_credito=(campagna_credito-mean(campagna_credito,na.rm=T))/sd(campagna_credito,na.rm=T),	invio_modulistica_lm=(invio_modulistica_lm-mean(invio_modulistica_lm,na.rm=T))/sd(invio_modulistica_lm,na.rm=T),	variazione_autolettura=(variazione_autolettura-mean(variazione_autolettura,na.rm=T))/sd(variazione_autolettura,na.rm=T),	campagna_disattivazione=(campagna_disattivazione-mean(campagna_disattivazione,na.rm=T))/sd(campagna_disattivazione,na.rm=T),	reclamo_contorelax_lm=(reclamo_contorelax_lm-mean(reclamo_contorelax_lm,na.rm=T))/sd(reclamo_contorelax_lm,na.rm=T),	
                                       info_spedizione=(info_spedizione-mean(info_spedizione,na.rm=T))/sd(info_spedizione,na.rm=T),	fattmediav=(fattmediav-mean(fattmediav,na.rm=T))/sd(fattmediav,na.rm=T),	info_voltura_lm=(info_voltura_lm-mean(info_voltura_lm,na.rm=T))/sd(info_voltura_lm,na.rm=T),	variazione_anagrafica=(variazione_anagrafica-mean(variazione_anagrafica,na.rm=T))/sd(variazione_anagrafica,na.rm=T),	campagna_eliminare=(campagna_eliminare-mean(campagna_eliminare,na.rm=T))/sd(campagna_eliminare,na.rm=T),	invio_spedizione_lm=(invio_spedizione_lm-mean(invio_spedizione_lm,na.rm=T))/sd(invio_spedizione_lm,na.rm=T),	variazione_credito=(variazione_credito-mean(variazione_credito,na.rm=T))/sd(variazione_credito,na.rm=T),	campagna_guasto=(campagna_guasto-mean(campagna_guasto,na.rm=T))/sd(campagna_guasto,na.rm=T),	reclamo_eliminare_lm=(reclamo_eliminare_lm-mean(reclamo_eliminare_lm,na.rm=T))/sd(reclamo_eliminare_lm,na.rm=T),	
                                       invio_contratto=(invio_contratto-mean(invio_contratto,na.rm=T))/sd(invio_contratto,na.rm=T),	fattmediaa=(fattmediaa-mean(fattmediaa,na.rm=T))/sd(fattmediaa,na.rm=T),	invio_eliminare_lm=(invio_eliminare_lm-mean(invio_eliminare_lm,na.rm=T))/sd(invio_eliminare_lm,na.rm=T),	variazione_contorelax=(variazione_contorelax-mean(variazione_contorelax,na.rm=T))/sd(variazione_contorelax,na.rm=T),	campagna_promo_offerte=(campagna_promo_offerte-mean(campagna_promo_offerte,na.rm=T))/sd(campagna_promo_offerte,na.rm=T),	reclamo_attivazione_non_richiesta_lm=(reclamo_attivazione_non_richiesta_lm-mean(reclamo_attivazione_non_richiesta_lm,na.rm=T))/sd(reclamo_attivazione_non_richiesta_lm,na.rm=T),	variazione_fattura=(variazione_fattura-mean(variazione_fattura,na.rm=T))/sd(variazione_fattura,na.rm=T),	campagna_recapito_consulente=(campagna_recapito_consulente-mean(campagna_recapito_consulente,na.rm=T))/sd(campagna_recapito_consulente,na.rm=T),	reclamo_legale_lm=(reclamo_legale_lm-mean(reclamo_legale_lm,na.rm=T))/sd(reclamo_legale_lm,na.rm=T),	
                                       invio_fattura=(invio_fattura-mean(invio_fattura,na.rm=T))/sd(invio_fattura,na.rm=T),	fattmediam=(fattmediam-mean(fattmediam,na.rm=T))/sd(fattmediam,na.rm=T),	invio_rimodulazione_lm=(invio_rimodulazione_lm-mean(invio_rimodulazione_lm,na.rm=T))/sd(invio_rimodulazione_lm,na.rm=T),	variazione_disattivazione=(variazione_disattivazione-mean(variazione_disattivazione,na.rm=T))/sd(variazione_disattivazione,na.rm=T),	campagna_retention=(campagna_retention-mean(campagna_retention,na.rm=T))/sd(campagna_retention,na.rm=T),	reclamo_credito_lm=(reclamo_credito_lm-mean(reclamo_credito_lm,na.rm=T))/sd(reclamo_credito_lm,na.rm=T),	variazione_modulistica=(variazione_modulistica-mean(variazione_modulistica,na.rm=T))/sd(variazione_modulistica,na.rm=T),	campagna_sconto_rimborso=(campagna_sconto_rimborso-mean(campagna_sconto_rimborso,na.rm=T))/sd(campagna_sconto_rimborso,na.rm=T),	reclamo_sconto_rimborso_lm=(reclamo_sconto_rimborso_lm-mean(reclamo_sconto_rimborso_lm,na.rm=T))/sd(reclamo_sconto_rimborso_lm,na.rm=T),	
                                       invio_sconto_rimborso=(invio_sconto_rimborso-mean(invio_sconto_rimborso,na.rm=T))/sd(invio_sconto_rimborso,na.rm=T),	fattmediaaltro=(fattmediaaltro-mean(fattmediaaltro,na.rm=T))/sd(fattmediaaltro,na.rm=T),				reclamo_fattura_lm=(reclamo_fattura_lm-mean(reclamo_fattura_lm,na.rm=T))/sd(reclamo_fattura_lm,na.rm=T),	variazione_sconto_rimborso=(variazione_sconto_rimborso-mean(variazione_sconto_rimborso,na.rm=T))/sd(variazione_sconto_rimborso,na.rm=T),	campagna_tecnico=(campagna_tecnico-mean(campagna_tecnico,na.rm=T))/sd(campagna_tecnico,na.rm=T),	reclamo_voltura_lm=(reclamo_voltura_lm-mean(reclamo_voltura_lm,na.rm=T))/sd(reclamo_voltura_lm,na.rm=T),
                                       reclamo_attivazione=(reclamo_attivazione-mean(reclamo_attivazione,na.rm=T))/sd(reclamo_attivazione,na.rm=T),								variazione_attivazione_lm=(variazione_attivazione_lm-mean(variazione_attivazione_lm,na.rm=T))/sd(variazione_attivazione_lm,na.rm=T))


# apply(pib, 2, function(x) any(is.na(x))) # per capire quali colonne contengono nas

# salvo i dataframe come tavole parquet e lo rileggo come parquet prima di fare l'imputer
spark_write_parquet(pib, path = '/user/flavio/pib',mode='overwrite')
pib = spark_read_parquet(sc, "pib", "/user/flavio/pib",overwrite = TRUE)

### Imputazione Dati Mancanti
var_numeriche <- c("fattmedia","etareferente")
var_numeriche_imp <- paste0(var_numeriche,"_imp")

pib <- ft_imputer(pib, var_numeriche, var_numeriche_imp)

# imputazione per dati categoriali (uso la moda)
pib = pib %>% mutate(areanielsencliente_imp = ifelse(is.na(areanielsencliente), "Area 4", areanielsencliente))

#Salvo definitivamente la tabella
spark_write_parquet(pib, path = '/user/flavio/pib',mode='overwrite')

